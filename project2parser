%{

#include <stdio.h>
#include "zoomjoystrong.h"

int yyerror(char* s);

%}

%start program

%union { 
	int ival; 
	float fval;
}

%token END
%token END_STATEMENT
%token POINT
%token LINE
%token CIRCLE
%token RECTANGLE
%token SET_COLOR
%token <ival> INT
%token <fval> FLOAT

%% 

program:	stmt_list END END_STATEMENT
		{
			finish();
			exit(0);
		}
		;

stmt_list:	stmt
		|
		stmt stmt_list
		;

stmt:		command END_STATEMENT
		;

command:	LINE INT INT INT INT
		{	
			if($2 < 0 || $3 < 0 || $4 < 0 || $5 < 0 || $2 > WIDTH || $4 > WIDTH || $3 > HEIGHT || $5 > HEIGHT){
				yyerror("HEIGHT or WIDTH is out of bounds.");
			}else{
				line($2, $3, $4, $5);
			}
		}
		|
		POINT INT INT
		{
			if($2 < 0 || $3 < 0 || $2 > WIDTH || $3 > HEIGHT){
				yyerror("HEIGHT or WIDTH is out of bounds.");
			}else{
				point($2, $3);
			}
		}
		|
		CIRCLE INT INT INT
		{
			if($2 < 0 || $3 < 0 || $2 > WIDTH || $3 > HEIGHT){
				yyerror("HEIGHT or WIDTH is out of bounds.");
			}else{
				circle($2, $3, $4);
			}
		}
		|
		RECTANGLE INT INT INT INT
		{
			if($2 < 0 || $3 < 0 || $2 > WIDTH || $3 > HEIGHT){
				yyerror("HEIGHT or WIDTH is out of bounds.");
			}else{
				rectangle($2, $3, $4, $5);
			}
		}
		|
		SET_COLOR INT INT INT
		{
			if($2 < 0 || $3 < 0 || $4 < 0 || $2 > 255 || $3 > 255 || $4 > 255){
				yyerror("Invalid RGB color value.");
			}else{
				set_color($2, $3, $4);
			}
		}
		;

%%

int main(int argc, char* argv[])
{
	setup();
	return(yyparse());
}

int yyerror(char* s)
{
	fprintf(stderr, "%s\n", s);
	return 0;
}

